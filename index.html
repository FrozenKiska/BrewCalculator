<!DOCTYPE html>

<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ—Ñ–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* ==================== CSS –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==================== */
        :root {
            --coffee-teal: #508A8C;
            --coffee-dark-teal: #266C62;
            --coffee-cream: #D4C78F;
            --coffee-orange: #D2431B;
            --coffee-brown: #87281B;
            --coffee-bg-light: #f5f1e8;
            --coffee-bg-dark: #1a1614;
        }


    /* ==================== –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò ==================== */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background: linear-gradient(135deg, var(--coffee-bg-light) 0%, #e8dcc8 100%);
        color: var(--coffee-brown);
        padding: 16px;
        padding-bottom: 80px;
        line-height: 1.6;
        min-height: 100vh;
    }

    .container {
        max-width: 500px;
        margin: 0 auto;
        background: white;
        padding: 24px;
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(38, 108, 98, 0.15);
        border: 1px solid rgba(80, 138, 140, 0.1);
    }

    /* ==================== –¢–ò–ü–û–ì–†–ê–§–ò–ö–ê ==================== */
    h1 {
        text-align: center;
        color: var(--coffee-brown);
        margin-bottom: 24px;
        font-size: 28px;
        font-weight: 700;
        background: linear-gradient(135deg, var(--coffee-brown) 0%, var(--coffee-orange) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* ==================== –§–û–†–ú–´ ==================== */
    .input-group {
        margin-bottom: 20px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        font-size: 15px;
        color: var(--coffee-brown);
    }

    input, select {
        width: 100%;
        padding: 14px;
        border: 2px solid var(--coffee-teal);
        border-radius: 12px;
        font-size: 16px;
        background: white;
        color: var(--coffee-brown);
        transition: all 0.3s ease;
    }

    input:focus, select:focus {
        outline: none;
        border-color: var(--coffee-orange);
        box-shadow: 0 0 0 3px rgba(210, 67, 27, 0.1);
    }

    /* ==================== –ö–ù–û–ü–ö–ò ==================== */
    button {
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, var(--coffee-orange) 0%, var(--coffee-brown) 100%);
        color: white;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-size: 17px;
        font-weight: 700;
        transition: all 0.3s ease;
        margin-top: 24px;
        box-shadow: 0 4px 16px rgba(210, 67, 27, 0.3);
    }

    button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(210, 67, 27, 0.4);
    }

    button:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(210, 67, 27, 0.3);
    }

    .share-button {
        background: linear-gradient(135deg, var(--coffee-teal) 0%, var(--coffee-dark-teal) 100%);
        margin-top: 12px;
        box-shadow: 0 4px 16px rgba(38, 108, 98, 0.3);
    }

    .share-button:hover {
        box-shadow: 0 6px 20px rgba(38, 108, 98, 0.4);
    }

    /* ==================== –†–ï–ó–£–õ–¨–¢–ê–¢–´ ==================== */
    .results {
        margin-top: 24px;
        background: linear-gradient(135deg, rgba(80, 138, 140, 0.05) 0%, rgba(212, 199, 143, 0.05) 100%);
        padding: 20px;
        border-radius: 16px;
        display: none;
        animation: slideIn 0.4s ease;
        border: 2px solid var(--coffee-teal);
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .results.show {
        display: block;
    }

    .results h3 {
        margin-bottom: 16px;
        color: var(--coffee-brown);
        font-size: 20px;
        font-weight: 700;
        border-bottom: 2px solid var(--coffee-orange);
        padding-bottom: 12px;
    }

    .results h4 {
        margin-top: 20px;
        margin-bottom: 12px;
        color: var(--coffee-orange);
        font-size: 17px;
        font-weight: 600;
    }

    .results p {
        margin: 10px 0;
        line-height: 1.7;
        font-size: 15px;
        color: var(--coffee-brown);
    }

    .results strong {
        color: var(--coffee-orange);
        font-weight: 700;
    }

    .results em {
        color: var(--coffee-dark-teal);
        font-style: italic;
        display: block;
        margin-bottom: 12px;
    }

    .hidden {
        display: none;
    }

    /* ==================== –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê ==================== */
    body.dark-theme {
        background: linear-gradient(135deg, var(--coffee-bg-dark) 0%, #0d0c0a 100%);
    }

    body.dark-theme .container {
        background: #2a2420;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        border-color: rgba(80, 138, 140, 0.3);
    }

    body.dark-theme h1 {
        background: linear-gradient(135deg, var(--coffee-cream) 0%, var(--coffee-orange) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    body.dark-theme label {
        color: var(--coffee-cream);
    }

    body.dark-theme input,
    body.dark-theme select {
        background: #1a1614;
        border-color: var(--coffee-dark-teal);
        color: var(--coffee-cream);
    }

    body.dark-theme input:focus,
    body.dark-theme select:focus {
        border-color: var(--coffee-teal);
        box-shadow: 0 0 0 3px rgba(80, 138, 140, 0.2);
    }

    body.dark-theme .results {
        background: linear-gradient(135deg, rgba(38, 108, 98, 0.15) 0%, rgba(135, 40, 27, 0.15) 100%);
        border-color: var(--coffee-dark-teal);
    }

    body.dark-theme .results h3 {
        color: var(--coffee-cream);
        border-bottom-color: var(--coffee-teal);
    }

    body.dark-theme .results h4 {
        color: var(--coffee-teal);
    }

    body.dark-theme .results p {
        color: #d4c9b8;
    }

    body.dark-theme .results strong {
        color: var(--coffee-orange);
    }

    body.dark-theme .results em {
        color: var(--coffee-teal);
    }
</style>


</head>
<body>
    <div class="container">
        <h1>‚òï –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ—Ñ–µ</h1>


    <!-- –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è -->
    <div class="input-group">
        <label for="method">–ú–µ—Ç–æ–¥ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è:</label>
        <select id="method" onchange="toggleMethodFields()">
            <option value="v60">V60 (–ü—É—Ä–æ–≤–µ—Ä)</option>
            <option value="aeropress">Aeropress</option>
            <option value="coldbrew">Cold Brew</option>
        </select>
    </div>

    <!-- –°—Ç–∏–ª—å –∞—ç—Ä–æ–ø—Ä–µ—Å—Å–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è Aeropress) -->
    <div class="input-group" id="aeropress-style-group" style="display:none;">
        <label for="aeropressStyle">–°—Ç–∏–ª—å –∞—ç—Ä–æ–ø—Ä–µ—Å—Å–∞:</label>
        <select id="aeropressStyle">
            <option value="concentrate">–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç + —Ä–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ</option>
            <option value="direct">–ü—Ä—è–º–æ–µ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ</option>
        </select>
    </div>

    <!-- –°—Ç–∏–ª—å –∫–æ–ª–¥–±—Ä—é (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è Cold Brew) -->
    <div class="input-group" id="coldbrew-style-group" style="display:none;">
        <label for="coldbrewStyle">–°—Ç–∏–ª—å –∫–æ–ª–¥–±—Ä—é:</label>
        <select id="coldbrewStyle">
            <option value="classic">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π (–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç)</option>
            <option value="flash">–§–ª—ç—à –±—Ä—é (—Å –ª—å–¥–æ–º)</option>
        </select>
    </div>

    <!-- –í—Ä–µ–º—è –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è –∫–æ–ª–¥–±—Ä—é -->
    <div class="input-group" id="coldbrew-time-group" style="display:none;">
        <label for="coldbrewTime">–í—Ä–µ–º—è –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è:</label>
        <select id="coldbrewTime">
            <option value="12">12 —á–∞—Å–æ–≤</option>
            <option value="16" selected>16 —á–∞—Å–æ–≤</option>
            <option value="24">24 —á–∞—Å–∞</option>
        </select>
    </div>

    <!-- –í—ã–±–æ—Ä –∫–æ—Ñ–µ–º–æ–ª–∫–∏ -->
    <div class="input-group">
        <label for="grinder">–ö–æ—Ñ–µ–º–æ–ª–∫–∞:</label>
        <select id="grinder">
            <option value="timemore_c3">Timemore C3</option>
            <option value="comandante">Comandante (red clix)</option>
            <option value="1zpresso_jx">1Zpresso JX</option>
            <option value="1zpresso_je">1Zpresso JE</option>
        </select>
    </div>
    
    <!-- –û–±—ä–µ–º –Ω–∞–ø–∏—Ç–∫–∞ -->
    <div class="input-group">
        <label for="volume">–ñ–µ–ª–∞–µ–º—ã–π –æ–±—ä–µ–º –Ω–∞–ø–∏—Ç–∫–∞ (–º–ª):</label>
        <input type="number" id="volume" value="300" min="100" max="1000" step="10">
    </div>
    
    <!-- –°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è -->
    <div class="input-group">
        <label for="country">–°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è:</label>
        <select id="country">
            <option value="ethiopia">üá™üáπ –≠—Ñ–∏–æ–ø–∏—è</option>
            <option value="kenya">üá∞üá™ –ö–µ–Ω–∏—è</option>
            <option value="brazil">üáßüá∑ –ë—Ä–∞–∑–∏–ª–∏—è</option>
            <option value="guatemala">üá¨üáπ –ì–≤–∞—Ç–µ–º–∞–ª–∞</option>
            <option value="costarica">üá®üá∑ –ö–æ—Å—Ç–∞-–†–∏–∫–∞</option>
            <option value="elsalvador">üá∏üáª –≠–ª—å-–°–∞–ª—å–≤–∞–¥–æ—Ä</option>
            <option value="yemen">üáæüá™ –ô–µ–º–µ–Ω</option>
            <option value="indonesia">üáÆüá© –ò–Ω–¥–æ–Ω–µ–∑–∏—è</option>
            <option value="rwanda">üá∑üáº –†—É–∞–Ω–¥–∞ / –ë—É—Ä—É–Ω–¥–∏</option>
            <option value="mexico">üá≤üáΩ –ú–µ–∫—Å–∏–∫–∞</option>
            <option value="peru">üáµüá™ –ü–µ—Ä—É</option>
        </select>
    </div>

    <!-- –ú–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ -->
    <div class="input-group">
        <label for="process">–ú–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏:</label>
        <select id="process">
            <option value="washed">–ú—ã—Ç–∞—è</option>
            <option value="natural">–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è</option>
            <option value="honey">–•–∞–Ω–∏</option>
        </select>
    </div>

    <!-- –°–≤–µ–∂–µ—Å—Ç—å –∑–µ—Ä–Ω–∞ -->
    <div class="input-group">
        <label for="days">–î–Ω–µ–π –ø–æ—Å–ª–µ –æ–±–∂–∞—Ä–∫–∏:</label>
        <input type="number" id="days" value="7" min="0" max="30">
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ -->
    <button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç</button>

    <!-- –ë–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div class="results" id="results"></div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ —à–∞—Ä–∏–Ω–≥–∞ -->
    <button class="share-button hidden" id="shareButton" onclick="shareRecipe()">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ—Ü–µ–ø—Ç–æ–º</button>
</div>


<script>
    // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM WEB APP ====================
    const tg = window.Telegram.WebApp;
    
    // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
    tg.expand();
    
    // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
    tg.enableClosingConfirmation();
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º–Ω—É—é —Ç–µ–º—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    if (tg.colorScheme === 'dark') {
        document.body.classList.add('dark-theme');
    }

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
    tg.MainButton.setText('–ó–∞–∫—Ä—ã—Ç—å');
    tg.MainButton.hide();
    tg.MainButton.onClick(() => tg.close());

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
    tg.onEvent('themeChanged', () => {
        document.body.classList.toggle('dark-theme', tg.colorScheme === 'dark');
    });

    // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
    let lastRecipeText = ''; // –•—Ä–∞–Ω–∏—Ç —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞ –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞

    // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ====================
    
    /**
     * –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–º–æ–ª–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–æ—Ñ–µ–º–æ–ª–æ–∫
     * –ó–Ω–∞—á–µ–Ω–∏—è –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π
     */
    const GRINDER_SETTINGS = {
        timemore_c3: {
            v60: 14,        // V60: 12-16 –∫–ª–∏–∫–æ–≤
            aeropress: 14,  // Aeropress: 10-18 –∫–ª–∏–∫–æ–≤
            coldbrew: 23    // Cold Brew: 22-24 –∫–ª–∏–∫–∞
        },
        comandante: {
            v60: 42,        // V60: 35-50 –∫–ª–∏–∫–æ–≤
            aeropress: 42,  // Aeropress: 30-55 –∫–ª–∏–∫–æ–≤
            coldbrew: 70    // Cold Brew: 60-80 –∫–ª–∏–∫–æ–≤
        },
        '1zpresso_jx': {
            v60: 40,        // V60: 1.5-2.5 –æ–±–æ—Ä–æ—Ç–æ–≤ (30-50 –∫–ª–∏–∫–æ–≤)
            aeropress: 45,  // Aeropress: 1.5-3.0 –æ–±–æ—Ä–æ—Ç–æ–≤ (30-60 –∫–ª–∏–∫–æ–≤)
            coldbrew: 70    // Cold Brew: 3.0-4.0 –æ–±–æ—Ä–æ—Ç–æ–≤ (60-80 –∫–ª–∏–∫–æ–≤)
        },
        '1zpresso_je': {
            v60: 50,        // V60: 2.0-3.0 –æ–±–æ—Ä–æ—Ç–æ–≤ (40-60 –∫–ª–∏–∫–æ–≤)
            aeropress: 55,  // Aeropress: 2.0-3.5 –æ–±–æ—Ä–æ—Ç–æ–≤ (40-70 –∫–ª–∏–∫–æ–≤)
            coldbrew: 85    // Cold Brew: 3.5-5.0 –æ–±–æ—Ä–æ—Ç–æ–≤ (70-100 –∫–ª–∏–∫–æ–≤)
        }
    };

    /**
     * –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å—Ç—Ä–∞–Ω –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è –∫–æ—Ñ–µ
     * tempDelta: –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (+/- –≥—Ä–∞–¥—É—Å—ã)
     * grindDelta: –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ–º–æ–ª–∞ (+/- –∫–ª–∏–∫–∏)
     * ratio: —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫–æ—Ñ–µ/–≤–æ–¥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
     */
    const COUNTRY_SETTINGS = {
        ethiopia: { tempDelta: 1, grindDelta: 0, name: "–≠—Ñ–∏–æ–ø–∏—è" },
        kenya: { tempDelta: 2, grindDelta: 0, name: "–ö–µ–Ω–∏—è" },
        brazil: { tempDelta: -1, grindDelta: 1, ratio: 15, name: "–ë—Ä–∞–∑–∏–ª–∏—è" },
        guatemala: { tempDelta: 1, grindDelta: -1, name: "–ì–≤–∞—Ç–µ–º–∞–ª–∞" },
        costarica: { tempDelta: 1, grindDelta: 0, name: "–ö–æ—Å—Ç–∞-–†–∏–∫–∞" },
        elsalvador: { tempDelta: 0, grindDelta: 1, name: "–≠–ª—å-–°–∞–ª—å–≤–∞–¥–æ—Ä" },
        yemen: { tempDelta: -1, grindDelta: 1, name: "–ô–µ–º–µ–Ω" },
        indonesia: { tempDelta: -2, grindDelta: 2, name: "–ò–Ω–¥–æ–Ω–µ–∑–∏—è" },
        rwanda: { tempDelta: 1, grindDelta: -1, name: "–†—É–∞–Ω–¥–∞/–ë—É—Ä—É–Ω–¥–∏" },
        mexico: { tempDelta: 0, grindDelta: 0, name: "–ú–µ–∫—Å–∏–∫–∞" },
        peru: { tempDelta: -1, grindDelta: 1, name: "–ü–µ—Ä—É" }
    };

    /**
     * –ù–∞–∑–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
     */
    const PROCESS_NAMES = {
        washed: '–ú—ã—Ç–∞—è',
        natural: '–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è',
        honey: '–•–∞–Ω–∏'
    };

    /**
     * –ù–∞–∑–≤–∞–Ω–∏—è –∫–æ—Ñ–µ–º–æ–ª–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
     */
    const GRINDER_NAMES = {
        timemore_c3: 'Timemore C3',
        comandante: 'Comandante',
        '1zpresso_jx': '1Zpresso JX',
        '1zpresso_je': '1Zpresso JE'
    };

    // ==================== UI –§–£–ù–ö–¶–ò–ò ====================
    
    /**
     * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–æ–ª–µ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
     */
    function toggleMethodFields() {
        const method = document.getElementById('method').value;
        const aeropressStyleGroup = document.getElementById('aeropress-style-group');
        const coldbrewStyleGroup = document.getElementById('coldbrew-style-group');
        const coldbrewTimeGroup = document.getElementById('coldbrew-time-group');
        
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–æ–ª—è
        aeropressStyleGroup.style.display = 'none';
        coldbrewStyleGroup.style.display = 'none';
        coldbrewTimeGroup.style.display = 'none';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
        if (method === 'aeropress') {
            aeropressStyleGroup.style.display = 'block';
        } else if (method === 'coldbrew') {
            coldbrewStyleGroup.style.display = 'block';
            coldbrewTimeGroup.style.display = 'block';
        }
    }

    /**
     * –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ—Ü–µ–ø—Ç–∞
     */
    function calculate() {
        // Haptic feedback –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
        triggerHaptic('light');

        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ —Ñ–æ—Ä–º—ã
        const params = {
            method: document.getElementById('method').value,
            aeropressStyle: document.getElementById('aeropressStyle').value,
            coldbrewStyle: document.getElementById('coldbrewStyle').value,
            coldbrewTime: document.getElementById('coldbrewTime').value,
            grinder: document.getElementById('grinder').value,
            volume: parseFloat(document.getElementById('volume').value),
            country: document.getElementById('country').value,
            process: document.getElementById('process').value,
            days: parseInt(document.getElementById('days').value)
        };

        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ—Ü–µ–ø—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–µ—Ç–æ–¥–∞
        let resultHTML = '';
        switch (params.method) {
            case 'v60':
                resultHTML = calculateV60(params);
                break;
            case 'aeropress':
                resultHTML = calculateAeropress(params);
                break;
            case 'coldbrew':
                resultHTML = calculateColdBrew(params);
                break;
        }

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = resultHTML;
        resultsDiv.classList.add('show');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
        document.getElementById('shareButton').classList.remove('hidden');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É Telegram
        tg.MainButton.show();

        // Haptic feedback –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Ä–∞—Å—á–µ—Ç–µ
        triggerHaptic('success');
    }

    // ==================== –†–ê–°–ß–ï–¢ V60 ====================
    
    /**
     * –†–∞—Å—á–µ—Ç —Ä–µ—Ü–µ–ø—Ç–∞ –¥–ª—è V60 (–ø—É—Ä–æ–≤–µ—Ä)
     * @param {Object} params - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è
     * @returns {string} HTML —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
     */
    function calculateV60(params) {
        const { grinder, volume, country, process, days } = params;
        
        // –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        let ratio = 16; // –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –≤–æ–¥–∞:–∫–æ—Ñ–µ
        let baseTemp = 93; // –ë–∞–∑–æ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
        let baseGrind = GRINDER_SETTINGS[grinder].v60;

        // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —Å—Ç—Ä–∞–Ω–µ
        const countryData = COUNTRY_SETTINGS[country];
        baseTemp += countryData.tempDelta;
        baseGrind += countryData.grindDelta;
        if (countryData.ratio) ratio = countryData.ratio;

        // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –º–µ—Ç–æ–¥—É –æ–±—Ä–∞–±–æ—Ç–∫–∏
        if (process === "natural") {
            baseTemp -= 1;
            baseGrind += 1;
        } else if (process === "honey") {
            baseTemp -= 0.5;
        }

        // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–≤–µ–∂–µ—Å—Ç–∏ –∑–µ—Ä–Ω–∞
        if (days <= 5) {
            baseGrind += 1;
            baseTemp += 1;
        } else if (days >= 15) {
            baseGrind -= 1;
            baseTemp -= 1;
        }

        // –†–∞—Å—á–µ—Ç –≤–µ—Å–∞ –∫–æ—Ñ–µ –∏ –ø—Ä–æ–ª–∏–≤–æ–≤
        const coffeeWeight = Math.round(volume / ratio);
        const bloom = Math.round(coffeeWeight * 2);
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ª–∏–≤–æ–≤ –ø–æ –æ–±—ä–µ–º—É
        const pours = getPourSchedule(volume);
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —à–∞–≥–∏ –ø—Ä–æ–ª–∏–≤–æ–≤
        const steps = generatePourSteps(volume, bloom, pours);
        
        // –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
        const finishTime = pours[pours.length - 1].t + 30;
        const finishTimeStr = formatTime(finishTime);

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—É—é –≤–µ—Ä—Å–∏—é –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
        lastRecipeText = buildRecipeText('V60', {
            coffee: coffeeWeight,
            country: countryData.name,
            process: PROCESS_NAMES[process],
            temp: baseTemp,
            grind: Math.round(baseGrind),
            grinder: GRINDER_NAMES[grinder],
            volume,
            steps
        });

        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º HTML
        return `
            <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è V60</h3>
            <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
            <p>üåç –°—Ç—Ä–∞–Ω–∞: <strong>${countryData.name}</strong></p>
            <p>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã: <strong>${baseTemp.toFixed(1)}¬∞C</strong></p>
            <p>‚öôÔ∏è –ü–æ–º–æ–ª (${GRINDER_NAMES[grinder]}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
            <br>
            <h4>üíß –≠—Ç–∞–ø—ã –∑–∞–ª–∏–≤–∫–∏ —Å —Ç–∞–π–º–∏–Ω–≥–æ–º:</h4>
            ${steps.map((step, i) => `<p>${i + 1}Ô∏è‚É£ ${step}</p>`).join('')}
            <p>${steps.length + 1}Ô∏è‚É£ <strong>${finishTimeStr}</strong> - –û–∫–æ–Ω—á–∞–Ω–∏–µ —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏</p>
        `;
    }

    /**
     * –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–ª–∏–≤–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—ä–µ–º–∞
     * @param {number} volume - –û–±—ä–µ–º –Ω–∞–ø–∏—Ç–∫–∞ –≤ –º–ª
     * @returns {Array} –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º
     */
    function getPourSchedule(volume) {
        if (volume <= 250) {
            // 3 –ø—Ä–æ–ª–∏–≤–∞ –¥–ª—è –º–∞–ª–æ–≥–æ –æ–±—ä–µ–º–∞
            return [
                { pct: 40, t: 45 },
                { pct: 70, t: 90 },
                { pct: 100, t: 130 }
            ];
        } else if (volume <= 450) {
            // 4 –ø—Ä–æ–ª–∏–≤–∞ –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ –æ–±—ä–µ–º–∞
            return [
                { pct: 30, t: 40 },
                { pct: 50, t: 75 },
                { pct: 75, t: 110 },
                { pct: 100, t: 150 }
            ];
        } else {
            // 5 –ø—Ä–æ–ª–∏–≤–æ–≤ –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –æ–±—ä–µ–º–∞
            return [
                { pct: 25, t: 35 },
                { pct: 40, t: 65 },
                { pct: 60, t: 95 },
                { pct: 80, t: 130 },
                { pct: 100, t: 170 }
            ];
        }
    }

    /**
     * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —à–∞–≥–∏ –ø—Ä–æ–ª–∏–≤–æ–≤ —Å —Ç–∞–π–º–∏–Ω–≥–æ–º
     * @param {number} volume - –û–±—â–∏–π –æ–±—ä–µ–º
     * @param {number} bloom - –û–±—ä–µ–º –±–ª—é–º–∏–Ω–≥–∞
     * @param {Array} pours - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–ª–∏–≤–æ–≤
     * @returns {Array} –ú–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —à–∞–≥–æ–≤
     */
    function generatePourSteps(volume, bloom, pours) {
        const steps = [];
        steps.push(`<strong>0:00-0:30</strong> - –ë–ª—é–º–∏–Ω–≥: <strong>${bloom} –º–ª</strong>`);

        let waterSoFar = bloom;
        pours.forEach((pour, i) => {
            const targetMl = Math.round(volume * (pour.pct / 100));
            const pourMl = targetMl - waterSoFar;
            const timeStr = formatTime(pour.t);
            
            steps.push(`<strong>~${timeStr}</strong> - –ü—Ä–æ–ª–∏–≤ ${i + 1}: <strong>+${pourMl} –º–ª</strong> ‚Üí –≤—Å–µ–≥–æ <strong>${targetMl} –º–ª</strong>`);
            waterSoFar = targetMl;
        });

        return steps;
    }

    // ==================== –†–ê–°–ß–ï–¢ AEROPRESS ====================
    
    /**
     * –†–∞—Å—á–µ—Ç —Ä–µ—Ü–µ–ø—Ç–∞ –¥–ª—è Aeropress
     * @param {Object} params - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è
     * @returns {string} HTML —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
     */
    function calculateAeropress(params) {
        const { grinder, volume, country, process, days, aeropressStyle } = params;
        
        // –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        let baseTemp = 88;
        let baseGrind = GRINDER_SETTINGS[grinder].aeropress;

        // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
        const countryData = COUNTRY_SETTINGS[country];
        baseTemp += countryData.tempDelta;
        baseGrind += countryData.grindDelta;

        if (process === "natural") {
            baseTemp -= 1;
            baseGrind += 1;
        } else if (process === "honey") {
            baseTemp -= 0.5;
        }

        if (days <= 5) {
            baseGrind += 1;
            baseTemp += 1;
        } else if (days >= 15) {
            baseGrind -= 1;
            baseTemp -= 1;
        }

        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∏–ª—è
        if (aeropressStyle === 'concentrate') {
            return calculateAeropressConcentrate(volume, baseTemp, baseGrind, countryData, process, grinder);
        } else {
            return calculateAeropressDirect(volume, baseTemp, baseGrind, countryData, process, grinder);
        }
    }

    /**
     * Aeropress: —Å—Ç–∏–ª—å "–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç + —Ä–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ"
     */
    function calculateAeropressConcentrate(volume, baseTemp, baseGrind, countryData, process, grinder) {
        const coffeeWeight = 18;
        const brewWater = Math.round(coffeeWeight * 11);
        const bloom = Math.round(coffeeWeight * 2.8);
        const concentrate = Math.round(coffeeWeight * 4.2);
        const dilution = volume - concentrate;

        lastRecipeText = `‚òï –†–µ—Ü–µ–ø—Ç Aeropress (–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç)\n\n` +
            `–ö–æ—Ñ–µ: ${coffeeWeight} –≥\n` +
            `–°—Ç—Ä–∞–Ω–∞: ${countryData.name}\n` +
            `–û–±—Ä–∞–±–æ—Ç–∫–∞: ${PROCESS_NAMES[process]}\n` +
            `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${baseTemp.toFixed(1)}¬∞C\n` +
            `–ü–æ–º–æ–ª (${GRINDER_NAMES[grinder]}): ${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤\n` +
            `–ë–ª—é–º–∏–Ω–≥: ${Math.round(bloom)} –º–ª (30 —Å–µ–∫)\n` +
            `–î–æ–ª–∏–≤: ${Math.round(brewWater)} –º–ª\n` +
            `–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç: ~${concentrate} –º–ª\n` +
            `–†–∞–∑–±–∞–≤–∏—Ç—å: +${Math.round(dilution)} –º–ª`;

        return `
            <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è Aeropress</h3>
            <p><em>–°—Ç–∏–ª—å: –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç + —Ä–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ</em></p>
            <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
            <p>üåç –°—Ç—Ä–∞–Ω–∞: <strong>${countryData.name}</strong></p>
            <p>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã: <strong>${baseTemp.toFixed(1)}¬∞C</strong></p>
            <p>‚öôÔ∏è –ü–æ–º–æ–ª (${GRINDER_NAMES[grinder]}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
            <p>üîÑ –ü–æ–∑–∏—Ü–∏—è: <strong>Inverted (–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞—è)</strong></p>
            <br>
            <h4>üíß –≠—Ç–∞–ø—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</h4>
            <p>1Ô∏è‚É£ –ë–ª—é–º–∏–Ω–≥: <strong>${Math.round(bloom)} –º–ª</strong> –≤–æ–¥—ã (30 —Å–µ–∫)</p>
            <p>2Ô∏è‚É£ –î–æ–ª–∏–≤ –¥–æ: <strong>${Math.round(brewWater)} –º–ª</strong></p>
            <p>3Ô∏è‚É£ –í—Ä–µ–º—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏: <strong>1:30</strong> (–æ–±—â–µ–µ)</p>
            <p>4Ô∏è‚É£ –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç –∏ –ø—Ä–µ—Å—Å–æ–≤–∞–Ω–∏–µ: <strong>30 —Å–µ–∫</strong></p>
            <p>5Ô∏è‚É£ –ü–æ–ª—É—á–∏—Ç—Å—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç: <strong>~${concentrate} –º–ª</strong></p>
            <p>6Ô∏è‚É£ –†–∞–∑–±–∞–≤–∏—Ç—å –≤–æ–¥–æ–π: <strong>+${Math.round(dilution)} –º–ª</strong> –¥–æ ${volume} –º–ª</p>
        `;
    }

    /**
     * Aeropress: —Å—Ç–∏–ª—å "–ø—Ä—è–º–æ–µ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ"
     */
    function calculateAeropressDirect(volume, baseTemp, baseGrind, countryData, process, grinder) {
        const ratio = 15;
        const coffeeWeight = Math.round(volume / ratio * 10) / 10;
        const bloom = Math.round(coffeeWeight * 2.8);

        lastRecipeText = `‚òï –†–µ—Ü–µ–ø—Ç Aeropress (–ø—Ä—è–º–æ–µ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ)\n\n` +
            `–ö–æ—Ñ–µ: ${coffeeWeight} –≥\n` +
            `–°—Ç—Ä–∞–Ω–∞: ${countryData.name}\n` +
            `–û–±—Ä–∞–±–æ—Ç–∫–∞: ${PROCESS_NAMES[process]}\n` +
            `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${baseTemp.toFixed(1)}¬∞C\n` +
            `–ü–æ–º–æ–ª (${GRINDER_NAMES[grinder]}): ${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤\n` +
            `–ë–ª—é–º–∏–Ω–≥: ${Math.round(bloom)} –º–ª (30 —Å–µ–∫)\n` +
            `–û–±—â–∏–π –æ–±—ä–µ–º: ${volume} –º–ª`;

        return `
            <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è Aeropress</h3>
            <p><em>–°—Ç–∏–ª—å: –ü—Ä—è–º–æ–µ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ</em></p>
            <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
            <p>üåç –°—Ç—Ä–∞–Ω–∞: <strong>${countryData.name}</strong></p>
            <p>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã: <strong>${baseTemp.toFixed(1)}¬∞C</strong></p>
            <p>‚öôÔ∏è –ü–æ–º–æ–ª (${GRINDER_NAMES[grinder]}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
            <p>üîÑ –ü–æ–∑–∏—Ü–∏—è: <strong>Inverted (–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞—è)</strong></p>
            <br>
            <h4>üíß –≠—Ç–∞–ø—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</h4>
            <p>1Ô∏è‚É£ –ë–ª—é–º–∏–Ω–≥: <strong>${Math.round(bloom)} –º–ª</strong> –≤–æ–¥—ã (30 —Å–µ–∫)</p>
            <p>2Ô∏è‚É£ –î–æ–ª–∏–≤ –¥–æ: <strong>${Math.round(volume)} –º–ª</strong></p>
            <p>3Ô∏è‚É£ –í—Ä–µ–º—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏: <strong>1:30</strong> (–æ–±—â–µ–µ)</p>
            <p>4Ô∏è‚É£ –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç –∏ –ø—Ä–µ—Å—Å–æ–≤–∞–Ω–∏–µ: <strong>30-40 —Å–µ–∫</strong></p>
            <p>5Ô∏è‚É£ –ì–æ—Ç–æ–≤—ã–π –Ω–∞–ø–∏—Ç–æ–∫: <strong>${volume} –º–ª</strong></p>
        `;
    }

    // ==================== –†–ê–°–ß–ï–¢ COLD BREW ====================
    
    /**
     * –†–∞—Å—á–µ—Ç —Ä–µ—Ü–µ–ø—Ç–∞ –¥–ª—è Cold Brew
     * @param {Object} params - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è
     * @returns {string} HTML —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
     */
    function calculateColdBrew(params) {
        const { grinder, volume, country, process, coldbrewStyle, coldbrewTime } = params;
        
        let baseGrind = GRINDER_SETTINGS[grinder].coldbrew;
        const countryData = COUNTRY_SETTINGS[country];

        baseGrind += countryData.grindDelta;
        if (process === "natural") baseGrind += 1;

        if (coldbrewStyle === 'classic') {
            return calculateColdBrewClassic(volume, baseGrind, countryData, process, grinder, coldbrewTime);
        } else {
            return calculateColdBrewFlash(volume, baseGrind, countryData, process, grinder);
        }
    }

    /**
     * Cold Brew: –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç
     */
    function calculateColdBrewClassic(volume, baseGrind, countryData, process, grinder, brewTime) {
        const ratio = 8;
        const coffeeWeight = Math.round(volume / ratio * 10) / 10;
        const waterAmount = volume;
        const concentrate = Math.round(volume * 0.85);
        const suggestedDilution = Math.round(volume * 0.5);

        lastRecipeText = `‚òï –†–µ—Ü–µ–ø—Ç Cold Brew (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)\n\n` +
            `–ö–æ—Ñ–µ: ${coffeeWeight} –≥\n` +
            `–°—Ç—Ä–∞–Ω–∞: ${countryData.name}\n` +
            `–û–±—Ä–∞–±–æ—Ç–∫–∞: ${PROCESS_NAMES[process]}\n` +
            `–ü–æ–º–æ–ª (${GRINDER_NAMES[grinder]}): ${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤\n` +
            `–í–æ–¥–∞: ${Math.round(waterAmount)} –º–ª\n` +
            `–í—Ä–µ–º—è: ${brewTime} —á–∞—Å–æ–≤\n` +
            `–†–∞–∑–±–∞–≤–∏—Ç—å 1:1 (~${suggestedDilution} –º–ª)`;

        return `
            <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è Cold Brew</h3>
            <p><em>–°—Ç–∏–ª—å: –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç</em></p>
            <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
            <p>üåç –°—Ç—Ä–∞–Ω–∞: <strong>${countryData.name}</strong></p>
            <p>üå°Ô∏è –í–æ–¥–∞: <strong>–ö–æ–º–Ω–∞—Ç–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (20-25¬∞C)</strong></p>
            <p>‚öôÔ∏è –ü–æ–º–æ–ª (${GRINDER_NAMES[grinder]}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
            <p>‚è∞ –í—Ä–µ–º—è –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è: <strong>${brewTime} —á–∞—Å–æ–≤</strong></p>
            <br>
            <h4>üíß –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</h4>
            <p>1Ô∏è‚É£ –°–º–µ—à–∞—Ç—å –∫–æ—Ñ–µ —Å <strong>${Math.round(waterAmount)} –º–ª</strong> –≤–æ–¥—ã</p>
            <p>2Ô∏è‚É£ –ü–æ—Å—Ç–∞–≤–∏—Ç—å –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ –Ω–∞ <strong>${brewTime} —á–∞—Å–æ–≤</strong></p>
            <p>3Ô∏è‚É£ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –±—É–º–∞–∂–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä</p>
            <p>4Ô∏è‚É£ –ü–æ–ª—É—á–∏—Ç—Å—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç: <strong>~${concentrate} –º–ª</strong></p>
            <br>
            <h4>ü•§ –ü–æ–¥–∞—á–∞:</h4>
            <p>üí° –†–∞–∑–±–∞–≤–∏—Ç—å –≤–æ–¥–æ–π/–º–æ–ª–æ–∫–æ–º <strong>1:1</strong> (–¥–æ–±–∞–≤–∏—Ç—å ~${suggestedDilution} –º–ª)</p>
            <p>üßä –î–æ–±–∞–≤–∏—Ç—å –ª—ë–¥ –ø–æ –≤–∫—É—Å—É</p>
            <p>üì¶ –•—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ –¥–æ 2 –Ω–µ–¥–µ–ª—å</p>
        `;
    }

    /**
     * Cold Brew: —Ñ–ª—ç—à –±—Ä—é (—è–ø–æ–Ω—Å–∫–∏–π –º–µ—Ç–æ–¥)
     */
    function calculateColdBrewFlash(volume, baseGrind, countryData, process, grinder) {
        const ratio = 15;
        const iceWeight = Math.round(volume * 0.4);
        const hotWater = volume - iceWeight;
        const coffeeWeight = Math.round(hotWater / ratio * 10) / 10;
        
        let baseTemp = 95;
        baseTemp += countryData.tempDelta;

        const bloom = Math.round(coffeeWeight * 2);

        lastRecipeText = `‚òï –†–µ—Ü–µ–ø—Ç Cold Brew (—Ñ–ª—ç—à –±—Ä—é)\n\n` +
            `–ö–æ—Ñ–µ: ${coffeeWeight} –≥\n` +
            `–°—Ç—Ä–∞–Ω–∞: ${countryData.name}\n` +
            `–û–±—Ä–∞–±–æ—Ç–∫–∞: ${PROCESS_NAMES[process]}\n` +
            `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${baseTemp}¬∞C\n` +
            `–ü–æ–º–æ–ª (${GRINDER_NAMES[grinder]}): ${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤\n` +
            `–õ—ë–¥: ${iceWeight} –≥\n` +
            `–ì–æ—Ä—è—á–∞—è –≤–æ–¥–∞: ${Math.round(hotWater)} –º–ª`;

        return `
            <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è Cold Brew</h3>
            <p><em>–°—Ç–∏–ª—å: –§–ª—ç—à –±—Ä—é (—è–ø–æ–Ω—Å–∫–∏–π –º–µ—Ç–æ–¥)</em></p>
            <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
            <p>üåç –°—Ç—Ä–∞–Ω–∞: <strong>${countryData.name}</strong></p>
            <p>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã: <strong>${baseTemp}¬∞C</strong></p>
            <p>‚öôÔ∏è –ü–æ–º–æ–ª (${GRINDER_NAMES[grinder]}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
            <p>üßä –õ—ë–¥: <strong>${iceWeight} –≥</strong></p>
            <br>
            <h4>üíß –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</h4>
            <p>1Ô∏è‚É£ –ü–æ–ª–æ–∂–∏—Ç—å <strong>${iceWeight} –≥ –ª—å–¥–∞</strong> –≤ —Å–µ—Ä–≤–µ—Ä</p>
            <p>2Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥—Ä–∏–ø–ø–µ—Ä —Å –∫–æ—Ñ–µ –Ω–∞–¥ —Å–µ—Ä–≤–µ—Ä–æ–º</p>
            <p>3Ô∏è‚É£ –ë–ª—é–º–∏–Ω–≥: <strong>${Math.round(bloom)} –º–ª</strong> –≤–æ–¥—ã (30 —Å–µ–∫)</p>
            <p>4Ô∏è‚É£ –ó–∞–ª–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—É—é –≤–æ–¥—É: <strong>${Math.round(hotWater)} –º–ª</strong> –≥–æ—Ä—è—á–µ–π –≤–æ–¥—ã</p>
            <p>5Ô∏è‚É£ –ö–æ—Ñ–µ —Å—Ä–∞–∑—É –æ—Ö–ª–∞–∂–¥–∞–µ—Ç—Å—è, –ø–∞–¥–∞—è –Ω–∞ –ª—ë–¥</p>
            <p>6Ô∏è‚É£ –ì–æ—Ç–æ–≤—ã–π –Ω–∞–ø–∏—Ç–æ–∫: <strong>${volume} –º–ª</strong></p>
            <br>
            <h4>ü•§ –†–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
            <p>‚ú® –Ø—Ä–∫–∏–π, –∞—Ä–æ–º–∞—Ç–Ω—ã–π —Ö–æ–ª–æ–¥–Ω—ã–π –∫–æ—Ñ–µ –∑–∞ 3-4 –º–∏–Ω—É—Ç—ã</p>
            <p>üßä –°—Ä–∞–∑—É –≥–æ—Ç–æ–≤ –∫ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é</p>
        `;
    }

    // ==================== –£–¢–ò–õ–ò–¢–´ ====================
    
    /**
     * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è –∏–∑ —Å–µ–∫—É–Ω–¥ –≤ —Ñ–æ—Ä–º–∞—Ç MM:SS
     * @param {number} seconds - –í—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
     * @returns {string} –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
     */
    function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${minutes}:${secs.toString().padStart(2, '0')}`;
    }

    /**
     * –°–æ–∑–¥–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Ä–µ—Ü–µ–ø—Ç–∞ –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
     * @param {string} method - –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞
     * @param {Object} data - –î–∞–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç–∞
     * @returns {string} –¢–µ–∫—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Ä–µ—Ü–µ–ø—Ç–∞
     */
    function buildRecipeText(method, data) {
        let text = `‚òï –†–µ—Ü–µ–ø—Ç ${method}\n\n`;
        text += `–ö–æ—Ñ–µ: ${data.coffee} –≥\n`;
        text += `–°—Ç—Ä–∞–Ω–∞: ${data.country}\n`;
        text += `–û–±—Ä–∞–±–æ—Ç–∫–∞: ${data.process}\n`;
        text += `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${data.temp.toFixed(1)}¬∞C\n`;
        text += `–ü–æ–º–æ–ª (${data.grinder}): ${data.grind} –∫–ª–∏–∫–æ–≤\n`;
        text += `–û–±—ä–µ–º: ${data.volume} –º–ª\n\n`;
        
        if (data.steps) {
            text += `–ü—Ä–æ–ª–∏–≤—ã:\n`;
            text += data.steps.map((s, i) => `${i + 1}. ${s.replace(/<[^>]*>/g, '')}`).join('\n');
        }
        
        return text;
    }

    /**
     * –¢—Ä–∏–≥–≥–µ—Ä–∏—Ç haptic feedback (–≤–∏–±—Ä–∞—Ü–∏—é)
     * @param {string} type - –¢–∏–ø –≤–∏–±—Ä–∞—Ü–∏–∏: 'light', 'medium', 'heavy', 'success', 'error', 'warning'
     */
    function triggerHaptic(type) {
        if (!tg.HapticFeedback) return;
        
        switch (type) {
            case 'light':
            case 'medium':
            case 'heavy':
            case 'rigid':
            case 'soft':
                tg.HapticFeedback.impactOccurred(type);
                break;
            case 'success':
            case 'error':
            case 'warning':
                tg.HapticFeedback.notificationOccurred(type);
                break;
            case 'selection':
                tg.HapticFeedback.selectionChanged();
                break;
        }
    }

    // ==================== –®–ê–†–ò–ù–ì ====================
    
    /**
     * –î–µ–ª–∏—Ç—Å—è —Ä–µ—Ü–µ–ø—Ç–æ–º —á–µ—Ä–µ–∑ Telegram
     */
    function shareRecipe() {
        triggerHaptic('medium');

        if (!lastRecipeText) return;

        const shareText = lastRecipeText + '\n\nü§ñ –°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é Coffee Calculator Bot';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å query_id –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
        if (tg.initDataUnsafe && tg.initDataUnsafe.query_id) {
            tg.sendData(JSON.stringify({
                action: 'share_recipe',
                recipe: shareText
            }));
        } else {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º popup –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
            tg.showPopup({
                title: 'üìã –†–µ—Ü–µ–ø—Ç –≥–æ—Ç–æ–≤!',
                message: '–†–µ—Ü–µ–ø—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –≤ –ª—é–±–æ–π —á–∞—Ç Telegram.',
                buttons: [
                    { id: 'copy', type: 'default', text: '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑' },
                    { id: 'close', type: 'close', text: '–ó–∞–∫—Ä—ã—Ç—å' }
                ]
            }, (buttonId) => {
                if (buttonId === 'copy') {
                    copyToClipboard(shareText);
                }
            });
            
            copyToClipboard(shareText);
        }
    }

    /**
     * –ö–æ–ø–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
     * @param {string} text - –¢–µ–∫—Å—Ç –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
     */
    function copyToClipboard(text) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text)
                .then(() => triggerHaptic('success'))
                .catch(() => fallbackCopy(text));
        } else {
            fallbackCopy(text);
        }
    }

    /**
     * –†–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
     * @param {string} text - –¢–µ–∫—Å—Ç –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
     */
    function fallbackCopy(text) {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            document.execCommand('copy');
            triggerHaptic('success');
        } catch (err) {
            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å:', err);
        }
        
        document.body.removeChild(textArea);
    }

    // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
    
    /**
     * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
     */
    window.onload = () => {
        calculate();
    };
</script>

</body>
</html>