<!DOCTYPE html>

<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ—Ñ–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --coffee-teal: #508A8C;
            --coffee-dark-teal: #266C62;
            --coffee-cream: #D4C78F;
            --coffee-orange: #D2431B;
            --coffee-brown: #87281B;
            --coffee-bg-light: #f5f1e8;
            --coffee-bg-dark: #1a1614;
        }

```
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background: linear-gradient(135deg, var(--coffee-bg-light) 0%, #e8dcc8 100%);
        color: var(--coffee-brown);
        padding: 16px;
        padding-bottom: 80px;
        line-height: 1.6;
        min-height: 100vh;
    }

    .container {
        max-width: 500px;
        margin: 0 auto;
        background: white;
        padding: 24px;
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(38, 108, 98, 0.15);
        border: 1px solid rgba(80, 138, 140, 0.1);
    }

    h1 {
        text-align: center;
        color: var(--coffee-brown);
        margin-bottom: 24px;
        font-size: 28px;
        font-weight: 700;
        background: linear-gradient(135deg, var(--coffee-brown) 0%, var(--coffee-orange) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .input-group {
        margin-bottom: 20px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        font-size: 15px;
        color: var(--coffee-brown);
    }

    input, select {
        width: 100%;
        padding: 14px;
        border: 2px solid var(--coffee-teal);
        border-radius: 12px;
        font-size: 16px;
        background: white;
        color: var(--coffee-brown);
        transition: all 0.3s ease;
    }

    input:focus, select:focus {
        outline: none;
        border-color: var(--coffee-orange);
        box-shadow: 0 0 0 3px rgba(210, 67, 27, 0.1);
    }

    button {
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, var(--coffee-orange) 0%, var(--coffee-brown) 100%);
        color: white;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-size: 17px;
        font-weight: 700;
        transition: all 0.3s ease;
        margin-top: 24px;
        box-shadow: 0 4px 16px rgba(210, 67, 27, 0.3);
    }

    button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(210, 67, 27, 0.4);
    }

    button:active {
        transform: translateY(0);
        box-shadow: 0 2px 8px rgba(210, 67, 27, 0.3);
    }

    .share-button {
        background: linear-gradient(135deg, var(--coffee-teal) 0%, var(--coffee-dark-teal) 100%);
        margin-top: 12px;
        box-shadow: 0 4px 16px rgba(38, 108, 98, 0.3);
    }

    .share-button:hover {
        box-shadow: 0 6px 20px rgba(38, 108, 98, 0.4);
    }

    .results {
        margin-top: 24px;
        background: linear-gradient(135deg, rgba(80, 138, 140, 0.05) 0%, rgba(212, 199, 143, 0.05) 100%);
        padding: 20px;
        border-radius: 16px;
        display: none;
        animation: slideIn 0.4s ease;
        border: 2px solid var(--coffee-teal);
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .results.show {
        display: block;
    }

    .results h3 {
        margin-bottom: 16px;
        color: var(--coffee-brown);
        font-size: 20px;
        font-weight: 700;
        border-bottom: 2px solid var(--coffee-orange);
        padding-bottom: 12px;
    }

    .results h4 {
        margin-top: 20px;
        margin-bottom: 12px;
        color: var(--coffee-orange);
        font-size: 17px;
        font-weight: 600;
    }

    .results p {
        margin: 10px 0;
        line-height: 1.7;
        font-size: 15px;
        color: var(--coffee-brown);
    }

    .results strong {
        color: var(--coffee-orange);
        font-weight: 700;
    }

    .results em {
        color: var(--coffee-dark-teal);
        font-style: italic;
        display: block;
        margin-bottom: 12px;
    }

    .hidden {
        display: none;
    }

    /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
    body.dark-theme {
        background: linear-gradient(135deg, var(--coffee-bg-dark) 0%, #0d0c0a 100%);
    }

    body.dark-theme .container {
        background: #2a2420;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        border-color: rgba(80, 138, 140, 0.3);
    }

    body.dark-theme h1 {
        background: linear-gradient(135deg, var(--coffee-cream) 0%, var(--coffee-orange) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    body.dark-theme label {
        color: var(--coffee-cream);
    }

    body.dark-theme input,
    body.dark-theme select {
        background: #1a1614;
        border-color: var(--coffee-dark-teal);
        color: var(--coffee-cream);
    }

    body.dark-theme input:focus,
    body.dark-theme select:focus {
        border-color: var(--coffee-teal);
        box-shadow: 0 0 0 3px rgba(80, 138, 140, 0.2);
    }

    body.dark-theme .results {
        background: linear-gradient(135deg, rgba(38, 108, 98, 0.15) 0%, rgba(135, 40, 27, 0.15) 100%);
        border-color: var(--coffee-dark-teal);
    }

    body.dark-theme .results h3 {
        color: var(--coffee-cream);
        border-bottom-color: var(--coffee-teal);
    }

    body.dark-theme .results h4 {
        color: var(--coffee-teal);
    }

    body.dark-theme .results p {
        color: #d4c9b8;
    }

    body.dark-theme .results strong {
        color: var(--coffee-orange);
    }

    body.dark-theme .results em {
        color: var(--coffee-teal);
    }
</style>
```

</head>
<body>
    <div class="container">
        <h1>‚òï –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ—Ñ–µ</h1>

```
    <div class="input-group">
        <label for="method">–ú–µ—Ç–æ–¥ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è:</label>
        <select id="method" onchange="toggleMethodFields()">
            <option value="v60">V60 (–ü—É—Ä–æ–≤–µ—Ä)</option>
            <option value="aeropress">Aeropress</option>
            <option value="coldbrew">Cold Brew</option>
        </select>
    </div>

    <div class="input-group" id="aeropress-style-group" style="display:none;">
        <label for="aeropressStyle">–°—Ç–∏–ª—å –∞—ç—Ä–æ–ø—Ä–µ—Å—Å–∞:</label>
        <select id="aeropressStyle">
            <option value="concentrate">–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç + —Ä–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ</option>
            <option value="direct">–ü—Ä—è–º–æ–µ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ</option>
        </select>
    </div>

    <div class="input-group" id="coldbrew-style-group" style="display:none;">
        <label for="coldbrewStyle">–°—Ç–∏–ª—å –∫–æ–ª–¥–±—Ä—é:</label>
        <select id="coldbrewStyle">
            <option value="classic">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π (–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç)</option>
            <option value="flash">–§–ª—ç—à –±—Ä—é (—Å –ª—å–¥–æ–º)</option>
        </select>
    </div>

    <div class="input-group" id="coldbrew-time-group" style="display:none;">
        <label for="coldbrewTime">–í—Ä–µ–º—è –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è:</label>
        <select id="coldbrewTime">
            <option value="12">12 —á–∞—Å–æ–≤</option>
            <option value="16" selected>16 —á–∞—Å–æ–≤</option>
            <option value="24">24 —á–∞—Å–∞</option>
        </select>
    </div>

    <div class="input-group">
        <label for="grinder">–ö–æ—Ñ–µ–º–æ–ª–∫–∞:</label>
        <select id="grinder">
            <option value="timemore_c3">Timemore C3</option>
            <option value="comandante">Comandante (red clix)</option>
            <option value="1zpresso_jx">1Zpresso JX</option>
            <option value="1zpresso_je">1Zpresso JE</option>
        </select>
    </div>
    
    <div class="input-group">
        <label for="volume">–ñ–µ–ª–∞–µ–º—ã–π –æ–±—ä–µ–º –Ω–∞–ø–∏—Ç–∫–∞ (–º–ª):</label>
        <input type="number" id="volume" value="300" min="100" max="1000" step="10">
    </div>
    
    <div class="input-group">
        <label for="country">–°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è:</label>
        <select id="country">
            <option value="ethiopia">üá™üáπ –≠—Ñ–∏–æ–ø–∏—è</option>
            <option value="kenya">üá∞üá™ –ö–µ–Ω–∏—è</option>
            <option value="brazil">üáßüá∑ –ë—Ä–∞–∑–∏–ª–∏—è</option>
            <option value="guatemala">üá¨üáπ –ì–≤–∞—Ç–µ–º–∞–ª–∞</option>
            <option value="costarica">üá®üá∑ –ö–æ—Å—Ç–∞-–†–∏–∫–∞</option>
            <option value="elsalvador">üá∏üáª –≠–ª—å-–°–∞–ª—å–≤–∞–¥–æ—Ä</option>
            <option value="yemen">üáæüá™ –ô–µ–º–µ–Ω</option>
            <option value="indonesia">üáÆüá© –ò–Ω–¥–æ–Ω–µ–∑–∏—è</option>
            <option value="rwanda">üá∑üáº –†—É–∞–Ω–¥–∞ / –ë—É—Ä—É–Ω–¥–∏</option>
            <option value="mexico">üá≤üáΩ –ú–µ–∫—Å–∏–∫–∞</option>
            <option value="peru">üáµüá™ –ü–µ—Ä—É</option>
        </select>
    </div>

    <div class="input-group">
        <label for="process">–ú–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏:</label>
        <select id="process">
            <option value="washed">–ú—ã—Ç–∞—è</option>
            <option value="natural">–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è</option>
            <option value="honey">–•–∞–Ω–∏</option>
        </select>
    </div>

    <div class="input-group">
        <label for="days">–î–Ω–µ–π –ø–æ—Å–ª–µ –æ–±–∂–∞—Ä–∫–∏:</label>
        <input type="number" id="days" value="7" min="0" max="30">
    </div>

    <button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç</button>

    <div class="results" id="results"></div>
    <button class="share-button hidden" id="shareButton" onclick="shareRecipe()">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ—Ü–µ–ø—Ç–æ–º</button>
</div>
```

<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
    let tg = window.Telegram.WebApp;
    
    tg.expand();
    tg.enableClosingConfirmation();
    
    if (tg.colorScheme === 'dark') {
        document.body.classList.add('dark-theme');
    }

    tg.MainButton.setText('–ó–∞–∫—Ä—ã—Ç—å');
    tg.MainButton.hide();
    tg.MainButton.onClick(function() {
        tg.close();
    });

    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞
    let lastRecipeText = '';

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–º–æ–ª–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–æ—Ñ–µ–º–æ–ª–æ–∫ (–ø–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π)
    const grinderSettings = {
        timemore_c3: {
            v60: 14,        // V60: 12-16 –∫–ª–∏–∫–æ–≤
            aeropress: 14,  // Aeropress: 10-18 –∫–ª–∏–∫–æ–≤
            coldbrew: 23    // Cold Brew: 22-24 –∫–ª–∏–∫–∞
        },
        comandante: {
            v60: 42,        // V60: 35-50 –∫–ª–∏–∫–æ–≤
            aeropress: 42,  // Aeropress: 30-55 –∫–ª–∏–∫–æ–≤
            coldbrew: 70    // Cold Brew: 60-80 –∫–ª–∏–∫–æ–≤
        },
        '1zpresso_jx': {
            v60: 40,        // V60: 1.5-2.5 –æ–±–æ—Ä–æ—Ç–æ–≤ (30-50 –∫–ª–∏–∫–æ–≤)
            aeropress: 45,  // Aeropress: 1.5-3.0 –æ–±–æ—Ä–æ—Ç–æ–≤ (30-60 –∫–ª–∏–∫–æ–≤)
            coldbrew: 70    // Cold Brew: 3.0-4.0 –æ–±–æ—Ä–æ—Ç–æ–≤ (60-80 –∫–ª–∏–∫–æ–≤)
        },
        '1zpresso_je': {
            v60: 50,        // V60: 2.0-3.0 –æ–±–æ—Ä–æ—Ç–æ–≤ (40-60 –∫–ª–∏–∫–æ–≤)
            aeropress: 55,  // Aeropress: 2.0-3.5 –æ–±–æ—Ä–æ—Ç–æ–≤ (40-70 –∫–ª–∏–∫–æ–≤)
            coldbrew: 85    // Cold Brew: 3.5-5.0 –æ–±–æ—Ä–æ—Ç–æ–≤ (70-100 –∫–ª–∏–∫–æ–≤)
        }
    };

    // –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å—Ç—Ä–∞–Ω
    const countrySettings = {
        ethiopia: { tempDelta: 1, grindDelta: 0, name: "–≠—Ñ–∏–æ–ø–∏—è" },
        kenya: { tempDelta: 2, grindDelta: 0, name: "–ö–µ–Ω–∏—è" },
        brazil: { tempDelta: -1, grindDelta: 1, ratio: 15, name: "–ë—Ä–∞–∑–∏–ª–∏—è" },
        guatemala: { tempDelta: 1, grindDelta: -1, name: "–ì–≤–∞—Ç–µ–º–∞–ª–∞" },
        costarica: { tempDelta: 1, grindDelta: 0, name: "–ö–æ—Å—Ç–∞-–†–∏–∫–∞" },
        elsalvador: { tempDelta: 0, grindDelta: 1, name: "–≠–ª—å-–°–∞–ª—å–≤–∞–¥–æ—Ä" },
        yemen: { tempDelta: -1, grindDelta: 1, name: "–ô–µ–º–µ–Ω" },
        indonesia: { tempDelta: -2, grindDelta: 2, name: "–ò–Ω–¥–æ–Ω–µ–∑–∏—è" },
        rwanda: { tempDelta: 1, grindDelta: -1, name: "–†—É–∞–Ω–¥–∞/–ë—É—Ä—É–Ω–¥–∏" },
        mexico: { tempDelta: 0, grindDelta: 0, name: "–ú–µ–∫—Å–∏–∫–∞" },
        peru: { tempDelta: -1, grindDelta: 1, name: "–ü–µ—Ä—É" }
    };

    function toggleMethodFields() {
        const method = document.getElementById('method').value;
        const aeropressStyleGroup = document.getElementById('aeropress-style-group');
        const coldbrewStyleGroup = document.getElementById('coldbrew-style-group');
        const coldbrewTimeGroup = document.getElementById('coldbrew-time-group');
        
        aeropressStyleGroup.style.display = 'none';
        coldbrewStyleGroup.style.display = 'none';
        coldbrewTimeGroup.style.display = 'none';
        
        if (method === 'aeropress') {
            aeropressStyleGroup.style.display = 'block';
        } else if (method === 'coldbrew') {
            coldbrewStyleGroup.style.display = 'block';
            coldbrewTimeGroup.style.display = 'block';
        }
    }

    function calculate() {
        if (tg.HapticFeedback) {
            tg.HapticFeedback.impactOccurred('light');
        }

        let method = document.getElementById('method').value;
        let aeropressStyle = document.getElementById('aeropressStyle').value;
        let coldbrewStyle = document.getElementById('coldbrewStyle').value;
        let coldbrewTime = document.getElementById('coldbrewTime').value;
        let grinder = document.getElementById('grinder').value;
        let volume = parseFloat(document.getElementById('volume').value);
        let country = document.getElementById('country').value;
        let process = document.getElementById('process').value;
        let days = parseInt(document.getElementById('days').value);

        let resultHTML = '';

        if (method === 'v60') {
            resultHTML = calculateV60(grinder, volume, country, process, days);
        } else if (method === 'aeropress') {
            resultHTML = calculateAeropress(grinder, volume, country, process, days, aeropressStyle);
        } else if (method === 'coldbrew') {
            resultHTML = calculateColdBrew(grinder, volume, country, process, days, coldbrewStyle, coldbrewTime);
        }

        let resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = resultHTML;
        resultsDiv.classList.add('show');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
        document.getElementById('shareButton').classList.remove('hidden');

        tg.MainButton.show();

        if (tg.HapticFeedback) {
            tg.HapticFeedback.notificationOccurred('success');
        }
    }

    function calculateV60(grinder, volume, country, process, days) {
        let ratio = 16;
        let baseTemp = 93;
        let baseGrind = grinderSettings[grinder].v60;

        // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω—ã
        const countryData = countrySettings[country];
        baseTemp += countryData.tempDelta;
        baseGrind += countryData.grindDelta;
        if (countryData.ratio) ratio = countryData.ratio;

        // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ
        if (process === "natural") {
            baseTemp -= 1;
            baseGrind += 1;
        } else if (process === "honey") {
            baseTemp -= 0.5;
        }

        // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–≤–µ–∂–µ—Å—Ç–∏
        if (days <= 5) {
            baseGrind += 1;
            baseTemp += 1;
        } else if (days >= 15) {
            baseGrind -= 1;
            baseTemp -= 1;
        }

        let coffeeWeight = Math.round(volume / ratio);
        let grinderName = getGrinderName(grinder);

        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–ª–∏–≤—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—ä–µ–º–∞
        let bloom = Math.round(coffeeWeight * 2);
        let steps = [];
        let pours = [];
        
        steps.push(`<strong>0:00-0:30</strong> - –ë–ª—é–º–∏–Ω–≥: <strong>${bloom} –º–ª</strong>`);

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ª–∏–≤–æ–≤ –ø–æ –æ–±—ä–µ–º—É
        if (volume <= 250) {
            // 3 –ø—Ä–æ–ª–∏–≤–∞
            pours = [
                { pct: 40, t: 45 },
                { pct: 70, t: 90 },
                { pct: 100, t: 130 }
            ];
        } else if (volume <= 450) {
            // 4 –ø—Ä–æ–ª–∏–≤–∞
            pours = [
                { pct: 30, t: 40 },
                { pct: 50, t: 75 },
                { pct: 75, t: 110 },
                { pct: 100, t: 150 }
            ];
        } else {
            // 5 –ø—Ä–æ–ª–∏–≤–æ–≤
            pours = [
                { pct: 25, t: 35 },
                { pct: 40, t: 65 },
                { pct: 60, t: 95 },
                { pct: 80, t: 130 },
                { pct: 100, t: 170 }
            ];
        }

        let waterSoFar = bloom;
        pours.forEach((p, i) => {
          const targetMl = Math.round(volume * (p.pct / 100));
          const pourMl = targetMl - waterSoFar;
          const minutes = Math.floor(p.t / 60);
          const seconds = p.t % 60;
          const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
          
          steps.push(`<strong>~${timeStr}</strong> - –ü—Ä–æ–ª–∏–≤ ${i+1}: <strong>+${pourMl} –º–ª</strong> ‚Üí –≤—Å–µ–≥–æ <strong>${targetMl} –º–ª</strong>`);
          waterSoFar = targetMl;
        });

        const finishTime = pours[pours.length - 1].t + 30;
        const finishMin = Math.floor(finishTime / 60);
        const finishSec = finishTime % 60;
        steps.push(`<strong>~${finishMin}:${finishSec.toString().padStart(2, '0')}</strong> - –û–∫–æ–Ω—á–∞–Ω–∏–µ —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏`);

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Ä–µ—Ü–µ–ø—Ç–∞
        lastRecipeText = `‚òï –†–µ—Ü–µ–ø—Ç V60\n\n` +
            `–ö–æ—Ñ–µ: ${coffeeWeight} –≥\n` +
            `–°—Ç—Ä–∞–Ω–∞: ${countryData.name}\n` +
            `–û–±—Ä–∞–±–æ—Ç–∫–∞: ${getProcessName(process)}\n` +
            `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${baseTemp.toFixed(1)}¬∞C\n` +
            `–ü–æ–º–æ–ª (${grinderName}): ${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤\n` +
            `–û–±—ä–µ–º: ${volume} –º–ª\n\n` +
            `–ü—Ä–æ–ª–∏–≤—ã:\n` +
            steps.map((s, i) => `${i+1}. ${s.replace(/<[^>]*>/g, '')}`).join('\n');

        return `
            <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è V60</h3>
            <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
            <p>üåç –°—Ç—Ä–∞–Ω–∞: <strong>${countryData.name}</strong></p>
            <p>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã: <strong>${baseTemp.toFixed(1)}¬∞C</strong></p>
            <p>‚öôÔ∏è –ü–æ–º–æ–ª (${grinderName}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
            <br>
            <h4>üíß –≠—Ç–∞–ø—ã –∑–∞–ª–∏–≤–∫–∏ —Å —Ç–∞–π–º–∏–Ω–≥–æ–º:</h4>
            ${steps.map((step, i) => `<p>${i+1}Ô∏è‚É£ ${step}</p>`).join('')}
        `;
    }

    function calculateAeropress(grinder, volume, country, process, days, style) {
        let baseTemp = 88;
        let baseGrind = grinderSettings[grinder].aeropress;

        const countryData = countrySettings[country];
        baseTemp += countryData.tempDelta;
        baseGrind += countryData.grindDelta;

        if (process === "natural") {
            baseTemp -= 1;
            baseGrind += 1;
        } else if (process === "honey") {
            baseTemp -= 0.5;
        }

        if (days <= 5) {
            baseGrind += 1;
            baseTemp += 1;
        } else if (days >= 15) {
            baseGrind -= 1;
            baseTemp -= 1;
        }

        let grinderName = getGrinderName(grinder);

        if (style === 'concentrate') {
            let coffeeWeight = 18;
            let brewWater = Math.round(coffeeWeight * 11);
            let bloom = coffeeWeight * 2.8;
            let secondPour = brewWater;
            let concentrate = Math.round(coffeeWeight * 4.2);
            let dilution = volume - concentrate;

            lastRecipeText = `‚òï –†–µ—Ü–µ–ø—Ç Aeropress (–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç)\n\n` +
                `–ö–æ—Ñ–µ: ${coffeeWeight} –≥\n` +
                `–°—Ç—Ä–∞–Ω–∞: ${countryData.name}\n` +
                `–û–±—Ä–∞–±–æ—Ç–∫–∞: ${getProcessName(process)}\n` +
                `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${baseTemp.toFixed(1)}¬∞C\n` +
                `–ü–æ–º–æ–ª (${grinderName}): ${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤\n` +
                `–ë–ª—é–º–∏–Ω–≥: ${Math.round(bloom)} –º–ª (30 —Å–µ–∫)\n` +
                `–î–æ–ª–∏–≤: ${Math.round(secondPour)} –º–ª\n` +
                `–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç: ~${concentrate} –º–ª\n` +
                `–†–∞–∑–±–∞–≤–∏—Ç—å: +${Math.round(dilution)} –º–ª`;

            return `
                <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è Aeropress</h3>
                <p><em>–°—Ç–∏–ª—å: –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç + —Ä–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ</em></p>
                <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
                <p>üåç –°—Ç—Ä–∞–Ω–∞: <strong>${countryData.name}</strong></p>
                <p>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã: <strong>${baseTemp.toFixed(1)}¬∞C</strong></p>
                <p>‚öôÔ∏è –ü–æ–º–æ–ª (${grinderName}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
                <p>üîÑ –ü–æ–∑–∏—Ü–∏—è: <strong>Inverted (–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞—è)</strong></p>
                <br>
                <h4>üíß –≠—Ç–∞–ø—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</h4>
                <p>1Ô∏è‚É£ –ë–ª—é–º–∏–Ω–≥: <strong>${Math.round(bloom)} –º–ª</strong> –≤–æ–¥—ã (30 —Å–µ–∫)</p>
                <p>2Ô∏è‚É£ –î–æ–ª–∏–≤ –¥–æ: <strong>${Math.round(secondPour)} –º–ª</strong></p>
                <p>3Ô∏è‚É£ –í—Ä–µ–º—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏: <strong>1:30</strong> (–æ–±—â–µ–µ)</p>
                <p>4Ô∏è‚É£ –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç –∏ –ø—Ä–µ—Å—Å–æ–≤–∞–Ω–∏–µ: <strong>30 —Å–µ–∫</strong></p>
                <p>5Ô∏è‚É£ –ü–æ–ª—É—á–∏—Ç—Å—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç: <strong>~${concentrate} –º–ª</strong></p>
                <p>6Ô∏è‚É£ –†–∞–∑–±–∞–≤–∏—Ç—å –≤–æ–¥–æ–π: <strong>+${Math.round(dilution)} –º–ª</strong> –¥–æ ${volume} –º–ª</p>
            `;
        } else {
            let ratio = 15;
            let coffeeWeight = Math.round(volume / ratio * 10) / 10;
            let bloom = coffeeWeight * 2.8;
            let totalWater = volume;

            lastRecipeText = `‚òï –†–µ—Ü–µ–ø—Ç Aeropress (–ø—Ä—è–º–æ–µ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ)\n\n` +
                `–ö–æ—Ñ–µ: ${coffeeWeight} –≥\n` +
                `–°—Ç—Ä–∞–Ω–∞: ${countryData.name}\n` +
                `–û–±—Ä–∞–±–æ—Ç–∫–∞: ${getProcessName(process)}\n` +
                `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${baseTemp.toFixed(1)}¬∞C\n` +
                `–ü–æ–º–æ–ª (${grinderName}): ${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤\n` +
                `–ë–ª—é–º–∏–Ω–≥: ${Math.round(bloom)} –º–ª (30 —Å–µ–∫)\n` +
                `–û–±—â–∏–π –æ–±—ä–µ–º: ${totalWater} –º–ª`;

            return `
                <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è Aeropress</h3>
                <p><em>–°—Ç–∏–ª—å: –ü—Ä—è–º–æ–µ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ</em></p>
                <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
                <p>üåç –°—Ç—Ä–∞–Ω–∞: <strong>${countryData.name}</strong></p>
                <p>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã: <strong>${baseTemp.toFixed(1)}¬∞C</strong></p>
                <p>‚öôÔ∏è –ü–æ–º–æ–ª (${grinderName}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
                <p>üîÑ –ü–æ–∑–∏—Ü–∏—è: <strong>Inverted (–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞—è)</strong></p>
                <br>
                <h4>üíß –≠—Ç–∞–ø—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</h4>
                <p>1Ô∏è‚É£ –ë–ª—é–º–∏–Ω–≥: <strong>${Math.round(bloom)} –º–ª</strong> –≤–æ–¥—ã (30 —Å–µ–∫)</p>
                <p>2Ô∏è‚É£ –î–æ–ª–∏–≤ –¥–æ: <strong>${Math.round(totalWater)} –º–ª</strong></p>
                <p>3Ô∏è‚É£ –í—Ä–µ–º—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏: <strong>1:30</strong> (–æ–±—â–µ–µ)</p>
                <p>4Ô∏è‚É£ –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç –∏ –ø—Ä–µ—Å—Å–æ–≤–∞–Ω–∏–µ: <strong>30-40 —Å–µ–∫</strong></p>
                <p>5Ô∏è‚É£ –ì–æ—Ç–æ–≤—ã–π –Ω–∞–ø–∏—Ç–æ–∫: <strong>${volume} –º–ª</strong></p>
            `;
        }
    }

    function calculateColdBrew(grinder, volume, country, process, days, style, brewTime) {
        let baseGrind = grinderSettings[grinder].coldbrew;
        let grinderName = getGrinderName(grinder);
        const countryData = countrySettings[country];

        baseGrind += countryData.grindDelta;

        if (process === "natural") {
            baseGrind += 1;
        }

        if (style === 'classic') {
            let ratio = 8;
            let coffeeWeight = Math.round(volume / ratio * 10) / 10;
            let waterAmount = volume;
            let concentrate = volume;
            let suggestedDilution = Math.round(volume * 0.5);

            lastRecipeText = `‚òï –†–µ—Ü–µ–ø—Ç Cold Brew (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)\n\n` +
                `–ö–æ—Ñ–µ: ${coffeeWeight} –≥\n` +
                `–°—Ç—Ä–∞–Ω–∞: ${countryData.name}\n` +
                `–û–±—Ä–∞–±–æ—Ç–∫–∞: ${getProcessName(process)}\n` +
                `–ü–æ–º–æ–ª (${grinderName}): ${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤\n` +
                `–í–æ–¥–∞: ${Math.round(waterAmount)} –º–ª\n` +
                `–í—Ä–µ–º—è: ${brewTime} —á–∞—Å–æ–≤\n` +
                `–†–∞–∑–±–∞–≤–∏—Ç—å 1:1 (~${suggestedDilution} –º–ª)`;

            return `
                <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è Cold Brew</h3>
                <p><em>–°—Ç–∏–ª—å: –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç</em></p>
                <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
                <p>üåç –°—Ç—Ä–∞–Ω–∞: <strong>${countryData.name}</strong></p>
                <p>üå°Ô∏è –í–æ–¥–∞: <strong>–ö–æ–º–Ω–∞—Ç–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (20-25¬∞C)</strong></p>
                <p>‚öôÔ∏è –ü–æ–º–æ–ª (${grinderName}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
                <p>‚è∞ –í—Ä–µ–º—è –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è: <strong>${brewTime} —á–∞—Å–æ–≤</strong></p>
                <br>
                <h4>üíß –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</h4>
                <p>1Ô∏è‚É£ –°–º–µ—à–∞—Ç—å –∫–æ—Ñ–µ —Å <strong>${Math.round(waterAmount)} –º–ª</strong> –≤–æ–¥—ã</p>
                <p>2Ô∏è‚É£ –ü–æ—Å—Ç–∞–≤–∏—Ç—å –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ –Ω–∞ <strong>${brewTime} —á–∞—Å–æ–≤</strong></p>
                <p>3Ô∏è‚É£ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –±—É–º–∞–∂–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä</p>
                <p>4Ô∏è‚É£ –ü–æ–ª—É—á–∏—Ç—Å—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç: <strong>~${Math.round(concentrate * 0.85)} –º–ª</strong></p>
                <br>
                <h4>ü•§ –ü–æ–¥–∞—á–∞:</h4>
                <p>üí° –†–∞–∑–±–∞–≤–∏—Ç—å –≤–æ–¥–æ–π/–º–æ–ª–æ–∫–æ–º <strong>1:1</strong> (–¥–æ–±–∞–≤–∏—Ç—å ~${suggestedDilution} –º–ª)</p>
                <p>üßä –î–æ–±–∞–≤–∏—Ç—å –ª—ë–¥ –ø–æ –≤–∫—É—Å—É</p>
                <p>üì¶ –•—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ –¥–æ 2 –Ω–µ–¥–µ–ª—å</p>
            `;
        } else {
            let ratio = 15;
            let totalVolume = volume;
            let iceWeight = Math.round(volume * 0.4);
            let hotWater = volume - iceWeight;
            let coffeeWeight = Math.round(hotWater / ratio * 10) / 10;
            
            let baseTemp = 95;
            baseTemp += countryData.tempDelta;

            let bloom = coffeeWeight * 2;

            lastRecipeText = `‚òï –†–µ—Ü–µ–ø—Ç Cold Brew (—Ñ–ª—ç—à –±—Ä—é)\n\n` +
                `–ö–æ—Ñ–µ: ${coffeeWeight} –≥\n` +
                `–°—Ç—Ä–∞–Ω–∞: ${countryData.name}\n` +
                `–û–±—Ä–∞–±–æ—Ç–∫–∞: ${getProcessName(process)}\n` +
                `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${baseTemp}¬∞C\n` +
                `–ü–æ–º–æ–ª (${grinderName}): ${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤\n` +
                `–õ—ë–¥: ${iceWeight} –≥\n` +
                `–ì–æ—Ä—è—á–∞—è –≤–æ–¥–∞: ${Math.round(hotWater)} –º–ª`;

            return `
                <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è Cold Brew</h3>
                <p><em>–°—Ç–∏–ª—å: –§–ª—ç—à –±—Ä—é (—è–ø–æ–Ω—Å–∫–∏–π –º–µ—Ç–æ–¥)</em></p>
                <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
                <p>üåç –°—Ç—Ä–∞–Ω–∞: <strong>${countryData.name}</strong></p>
                <p>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã: <strong>${baseTemp}¬∞C</strong></p>
                <p>‚öôÔ∏è –ü–æ–º–æ–ª (${grinderName}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
                <p>üßä –õ—ë–¥: <strong>${iceWeight} –≥</strong></p>
                <br>
                <h4>üíß –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</h4>
                <p>1Ô∏è‚É£ –ü–æ–ª–æ–∂–∏—Ç—å <strong>${iceWeight} –≥ –ª—å–¥–∞</strong> –≤ —Å–µ—Ä–≤–µ—Ä</p>
                <p>2Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥—Ä–∏–ø–ø–µ—Ä —Å –∫–æ—Ñ–µ –Ω–∞–¥ —Å–µ—Ä–≤–µ—Ä–æ–º</p>
                <p>3Ô∏è‚É£ –ë–ª—é–º–∏–Ω–≥: <strong>${Math.round(bloom)} –º–ª</strong> –≤–æ–¥—ã (30 —Å–µ–∫)</p>
                <p>4Ô∏è‚É£ –ó–∞–ª–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—É—é –≤–æ–¥—É: <strong>${Math.round(hotWater)} –º–ª</strong> –≥–æ—Ä—è—á–µ–π –≤–æ–¥—ã</p>
                <p>5Ô∏è‚É£ –ö–æ—Ñ–µ —Å—Ä–∞–∑—É –æ—Ö–ª–∞–∂–¥–∞–µ—Ç—Å—è, –ø–∞–¥–∞—è –Ω–∞ –ª—ë–¥</p>
                <p>6Ô∏è‚É£ –ì–æ—Ç–æ–≤—ã–π –Ω–∞–ø–∏—Ç–æ–∫: <strong>${totalVolume} –º–ª</strong></p>
                <br>
                <h4>ü•§ –†–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
                <p>‚ú® –Ø—Ä–∫–∏–π, –∞—Ä–æ–º–∞—Ç–Ω—ã–π —Ö–æ–ª–æ–¥–Ω—ã–π –∫–æ—Ñ–µ –∑–∞ 3-4 –º–∏–Ω—É—Ç—ã</p>
                <p>üßä –°—Ä–∞–∑—É –≥–æ—Ç–æ–≤ –∫ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é</p>
            `;
        }
    }

    function shareRecipe() {
        if (tg.HapticFeedback) {
            tg.HapticFeedback.impactOccurred('medium');
        }

        if (lastRecipeText) {
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
            const shareText = lastRecipeText + '\n\nü§ñ –°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é Coffee Calculator Bot';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å switchInlineQuery (–¥–ª—è –±–æ—Ç–æ–≤)
            if (tg.initDataUnsafe && tg.initDataUnsafe.query_id) {
                // –ï—Å–ª–∏ –µ—Å—Ç—å query_id, –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
                tg.sendData(JSON.stringify({
                    action: 'share_recipe',
                    recipe: shareText
                }));
            } else {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º showPopup –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ—Ü–µ–ø—Ç–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                tg.showPopup({
                    title: 'üìã –†–µ—Ü–µ–ø—Ç –≥–æ—Ç–æ–≤!',
                    message: '–†–µ—Ü–µ–ø—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –≤ –ª—é–±–æ–π —á–∞—Ç Telegram.',
                    buttons: [
                        {id: 'copy', type: 'default', text: '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑'},
                        {id: 'close', type: 'close', text: '–ó–∞–∫—Ä—ã—Ç—å'}
                    ]
                }, function(buttonId) {
                    if (buttonId === 'copy') {
                        copyToClipboard(shareText);
                    }
                });
                
                // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                copyToClipboard(shareText);
            }
        }
    }

    function copyToClipboard(text) {
        // –î–ª—è Telegram Mini App –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(function() {
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('success');
                }
            }).catch(function(err) {
                // Fallback –º–µ—Ç–æ–¥
                fallbackCopy(text);
            });
        } else {
            fallbackCopy(text);
        }
    }

    function fallbackCopy(text) {
        // –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            document.execCommand('copy');
            if (tg.HapticFeedback) {
                tg.HapticFeedback.notificationOccurred('success');
            }
        } catch (err) {
            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å:', err);
        }
        
        document.body.removeChild(textArea);
    }

    function getGrinderName(grinder) {
        const names = {
            'timemore_c3': 'Timemore C3',
            'comandante': 'Comandante',
            '1zpresso_jx': '1Zpresso JX',
            '1zpresso_je': '1Zpresso JE'
        };
        return names[grinder] || grinder;
    }

    function getProcessName(process) {
        const names = {
            'washed': '–ú—ã—Ç–∞—è',
            'natural': '–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è',
            'honey': '–•–∞–Ω–∏'
        };
        return names[process] || process;
    }

    function shareRecipe() {
        if (tg.HapticFeedback) {
            tg.HapticFeedback.impactOccurred('medium');
        }

        if (lastRecipeText) {
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
            const shareText = lastRecipeText + '\n\nü§ñ –°–æ–∑–¥–∞–Ω–æ —Å –ø–æ–º–æ—â—å—é Coffee Calculator Bot';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å switchInlineQuery (–¥–ª—è –±–æ—Ç–æ–≤)
            if (tg.initDataUnsafe && tg.initDataUnsafe.query_id) {
                // –ï—Å–ª–∏ –µ—Å—Ç—å query_id, –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
                tg.sendData(JSON.stringify({
                    action: 'share_recipe',
                    recipe: shareText
                }));
            } else {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º showPopup –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ—Ü–µ–ø—Ç–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                tg.showPopup({
                    title: 'üìã –†–µ—Ü–µ–ø—Ç –≥–æ—Ç–æ–≤!',
                    message: '–†–µ—Ü–µ–ø—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –≤ –ª—é–±–æ–π —á–∞—Ç Telegram.',
                    buttons: [
                        {id: 'copy', type: 'default', text: '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑'},
                        {id: 'close', type: 'close', text: '–ó–∞–∫—Ä—ã—Ç—å'}
                    ]
                }, function(buttonId) {
                    if (buttonId === 'copy') {
                        copyToClipboard(shareText);
                    }
                });
                
                // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                copyToClipboard(shareText);
            }
        }
    }

    function copyToClipboard(text) {
        // –î–ª—è Telegram Mini App –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(function() {
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('success');
                }
            }).catch(function(err) {
                // Fallback –º–µ—Ç–æ–¥
                fallbackCopy(text);
            });
        } else {
            fallbackCopy(text);
        }
    }

    function fallbackCopy(text) {
        // –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            document.execCommand('copy');
            if (tg.HapticFeedback) {
                tg.HapticFeedback.notificationOccurred('success');
            }
        } catch (err) {
            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å:', err);
        }
        
        document.body.removeChild(textArea);
    }

    window.onload = function() {
        calculate();
    };

    tg.onEvent('themeChanged', function() {
        if (tg.colorScheme === 'dark') {
            document.body.classList.add('dark-theme');
        } else {
            document.body.classList.remove('dark-theme');
        }
    });
</script>

</body>
</html>