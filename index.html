<!DOCTYPE html>

<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ—Ñ–µ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
          * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
          }
      body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
          background: var(--tg-theme-bg-color, #f9f6f3);
          color: var(--tg-theme-text-color, #000);
          padding: 16px;
          padding-bottom: 80px;
      }

      .container {
          max-width: 500px;
          margin: 0 auto;
          background: var(--tg-theme-secondary-bg-color, #fff);
          padding: 20px;
          border-radius: 12px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }

      h1 {
          text-align: center;
          color: var(--tg-theme-text-color, #6b4f3f);
          margin-bottom: 20px;
          font-size: 24px;
      }

      .input-group {
          margin-bottom: 16px;
      }

      label {
          display: block;
          margin-bottom: 6px;
          font-weight: 600;
          font-size: 14px;
          color: var(--tg-theme-text-color, #333);
      }

      input, select {
          width: 100%;
          padding: 12px;
          border: 1px solid var(--tg-theme-hint-color, #ccc);
          border-radius: 8px;
          font-size: 16px;
          background: var(--tg-theme-bg-color, #fff);
          color: var(--tg-theme-text-color, #000);
          transition: border-color 0.3s;
      }

      input:focus, select:focus {
          outline: none;
          border-color: var(--tg-theme-button-color, #6b4f3f);
      }

      button {
          width: 100%;
          padding: 14px;
          background: var(--tg-theme-button-color, #6b4f3f);
          color: var(--tg-theme-button-text-color, #fff);
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-size: 16px;
          font-weight: 600;
          transition: opacity 0.3s;
          margin-top: 20px;
      }

      button:active {
          opacity: 0.8;
      }

      .results {
          margin-top: 20px;
          background: var(--tg-theme-bg-color, #f3ece7);
          padding: 16px;
          border-radius: 10px;
          display: none;
          animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
          from {
              opacity: 0;
              transform: translateY(-10px);
          }
          to {
              opacity: 1;
              transform: translateY(0);
          }
      }

      .results.show {
          display: block;
      }

      .results h3 {
          margin-bottom: 12px;
          color: var(--tg-theme-text-color, #6b4f3f);
          font-size: 18px;
      }

      .results h4 {
          margin-top: 16px;
          margin-bottom: 8px;
          color: var(--tg-theme-text-color, #6b4f3f);
          font-size: 16px;
      }

      .results p {
          margin: 8px 0;
          line-height: 1.5;
          font-size: 15px;
      }

      .results strong {
          color: var(--tg-theme-link-color, #6b4f3f);
      }

      .hidden {
          display: none;
      }

      /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
      body.dark-theme {
          background: #1a1a1a;
      }

      body.dark-theme .container {
          background: #2a2a2a;
          box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      }

      body.dark-theme input,
      body.dark-theme select {
          background: #1a1a1a;
          border-color: #444;
      }

      body.dark-theme .results {
          background: #1a1a1a;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>‚òï –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ—Ñ–µ</h1>
      <div class="input-group">
        <label for="method">–ú–µ—Ç–æ–¥ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏—è:</label>
        <select id="method" onchange="toggleMethodFields()">
          <option value="v60">V60 (–ü—É—Ä–æ–≤–µ—Ä)</option>
          <option value="aeropress">Aeropress</option>
        </select>
      </div>

      <div class="input-group" id="aeropress-style-group" style="display:none;">
        <label for="aeropressStyle">–°—Ç–∏–ª—å –∞—ç—Ä–æ–ø—Ä–µ—Å—Å–∞:</label>
        <select id="aeropressStyle">
          <option value="concentrate">–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç + —Ä–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ</option>
          <option value="direct">–ü—Ä—è–º–æ–µ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ</option>
        </select>
      </div>

      <div class="input-group">
        <label for="grinder">–ö–æ—Ñ–µ–º–æ–ª–∫–∞:</label>
        <select id="grinder">
          <option value="timemore_c3">Timemore C3</option>
          <option value="comandante">Comandante (red clix)</option>
          <option value="1zpresso_jx">1Zpresso JX</option>
          <option value="1zpresso_je">1Zpresso JE</option>
        </select>
      </div>

      <div class="input-group">
        <label for="volume">–ñ–µ–ª–∞–µ–º—ã–π –æ–±—ä–µ–º –Ω–∞–ø–∏—Ç–∫–∞ (–º–ª):</label>
        <input
          type="number"
          id="volume"
          value="300"
          min="100"
          max="1000"
          step="10"
        />
      </div>

      <div class="input-group">
        <label for="country">–°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è:</label>
        <select id="country">
          <option value="ethiopia">üá™üáπ –≠—Ñ–∏–æ–ø–∏—è</option>
          <option value="kenya">üá∞üá™ –ö–µ–Ω–∏—è</option>
          <option value="brazil">üáßüá∑ –ë—Ä–∞–∑–∏–ª–∏—è</option>
        </select>
      </div>

      <div class="input-group">
        <label for="process">–ú–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏:</label>
        <select id="process">
          <option value="washed">–ú—ã—Ç–∞—è</option>
          <option value="natural">–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è</option>
          <option value="honey">–•–∞–Ω–∏</option>
        </select>
      </div>

      <div class="input-group">
        <label for="days">–î–Ω–µ–π –ø–æ—Å–ª–µ –æ–±–∂–∞—Ä–∫–∏:</label>
        <input type="number" id="days" value="7" min="0" max="30" />
      </div>

      <button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç</button>

      <div class="results" id="results"></div>
    </div>
    <script>
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
      let tg = window.Telegram.WebApp;

      tg.expand();
      tg.enableClosingConfirmation();

      if (tg.colorScheme === 'dark') {
          document.body.classList.add('dark-theme');
      }

      tg.MainButton.setText('–ó–∞–∫—Ä—ã—Ç—å');
      tg.MainButton.hide();
      tg.MainButton.onClick(function() {
          tg.close();
      });

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–º–æ–ª–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–æ—Ñ–µ–º–æ–ª–æ–∫
      const grinderSettings = {
          timemore_c3: {
              v60: 17,      // —Å—Ä–µ–¥–Ω–µ–µ –º–µ–∂–¥—É 16-18
              aeropress: 14  // —Å—Ä–µ–¥–Ω–µ–µ –º–µ–∂–¥—É 13-15
          },
          comandante: {
              v60: 41,       // —Å—Ä–µ–¥–Ω–µ–µ –º–µ–∂–¥—É 34,43,46
              aeropress: 29
          },
          '1zpresso_jx': {
              v60: 73,       // —Å—Ä–µ–¥–Ω–µ–µ –º–µ–∂–¥—É 58-60, 63-66, 91-93
              aeropress: 54  // —Å—Ä–µ–¥–Ω–µ–µ –º–µ–∂–¥—É 53-54
          },
          '1zpresso_je': {
              v60: 82,       // —Å—Ä–µ–¥–Ω–µ–µ –º–µ–∂–¥—É 70-80, 83-85, 91-93
              aeropress: 73  // —Å—Ä–µ–¥–Ω–µ–µ –º–µ–∂–¥—É 72-74
          }
      };

      function toggleMethodFields() {
          const method = document.getElementById('method').value;
          const aeropressStyleGroup = document.getElementById('aeropress-style-group');

          if (method === 'aeropress') {
              aeropressStyleGroup.style.display = 'block';
          } else {
              aeropressStyleGroup.style.display = 'none';
          }
      }

      function calculate() {
          if (tg.HapticFeedback) {
              tg.HapticFeedback.impactOccurred('light');
          }

          let method = document.getElementById('method').value;
          let aeropressStyle = document.getElementById('aeropressStyle').value;
          let grinder = document.getElementById('grinder').value;
          let volume = parseFloat(document.getElementById('volume').value);
          let country = document.getElementById('country').value;
          let process = document.getElementById('process').value;
          let days = parseInt(document.getElementById('days').value);

          let resultHTML = '';

          if (method === 'v60') {
              resultHTML = calculateV60(grinder, volume, country, process, days);
          } else if (method === 'aeropress') {
              resultHTML = calculateAeropress(grinder, volume, country, process, days, aeropressStyle);
          }

          let resultsDiv = document.getElementById('results');
          resultsDiv.innerHTML = resultHTML;
          resultsDiv.classList.add('show');

          tg.MainButton.show();

          if (tg.HapticFeedback) {
              tg.HapticFeedback.notificationOccurred('success');
          }
      }

      function calculateV60(grinder, volume, country, process, days) {
          // –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
          let ratio = 16;
          let baseTemp = 93;
          let baseGrind = grinderSettings[grinder].v60;

          // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç—Ä–∞–Ω–µ
          if (country === "ethiopia") {
              baseTemp += 1;
          } else if (country === "kenya") {
              baseTemp += 2;
          } else if (country === "brazil") {
              baseTemp -= 1;
              ratio = 15;
          }

          // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ
          if (process === "natural") {
              baseTemp -= 1;
              baseGrind += 1;
          } else if (process === "honey") {
              baseTemp -= 0.5;
          }

          // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–≤–µ–∂–µ—Å—Ç–∏
          if (days <= 5) {
              baseGrind += 1;
              baseTemp += 1;
          } else if (days >= 15) {
              baseGrind -= 1;
              baseTemp -= 1;
          }

          // –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–∞—Å—á—ë—Ç—ã
          let coffeeWeight = Math.round(volume / ratio * 10) / 10;

          // –¢–∞–π–º–∏–Ω–≥–∏ –∑–∞–ª–∏–≤–æ–≤
          let bloom = coffeeWeight * 2;
          let firstPour = volume * 0.40;
          let secondPour = volume * 0.70;
          let finalPour = volume;

          let grinderName = getGrinderName(grinder);

          return `
              <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è V60</h3>
              <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
              <p>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã: <strong>${baseTemp.toFixed(1)}¬∞C</strong></p>
              <p>‚öôÔ∏è –ü–æ–º–æ–ª (${grinderName}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
              <br>
              <h4>üíß –≠—Ç–∞–ø—ã –∑–∞–ª–∏–≤–∫–∏:</h4>
              <p>1Ô∏è‚É£ –ë–ª—é–º–∏–Ω–≥: <strong>${Math.round(bloom)} –º–ª</strong> (30 —Å–µ–∫—É–Ω–¥)</p>
              <p>2Ô∏è‚É£ –ü–µ—Ä–≤—ã–π –∑–∞–ª–∏–≤ –¥–æ: <strong>${Math.round(firstPour)} –º–ª</strong></p>
              <p>3Ô∏è‚É£ –í—Ç–æ—Ä–æ–π –∑–∞–ª–∏–≤ –¥–æ: <strong>${Math.round(secondPour)} –º–ª</strong></p>
              <p>4Ô∏è‚É£ –§–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ª–∏–≤ –¥–æ: <strong>${Math.round(finalPour)} –º–ª</strong></p>
          `;
      }

      function calculateAeropress(grinder, volume, country, process, days, style) {
          // –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∞—ç—Ä–æ–ø—Ä–µ—Å—Å–∞
          let baseTemp = 88;
          let baseGrind = grinderSettings[grinder].aeropress;

          // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç—Ä–∞–Ω–µ
          if (country === "ethiopia") {
              baseTemp += 1;
          } else if (country === "kenya") {
              baseTemp += 2;
          } else if (country === "brazil") {
              baseTemp -= 1;
          }

          // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ
          if (process === "natural") {
              baseTemp -= 1;
              baseGrind += 1;
          } else if (process === "honey") {
              baseTemp -= 0.5;
          }

          // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–≤–µ–∂–µ—Å—Ç–∏
          if (days <= 5) {
              baseGrind += 1;
              baseTemp += 1;
          } else if (days >= 15) {
              baseGrind -= 1;
              baseTemp -= 1;
          }

          let grinderName = getGrinderName(grinder);

          if (style === 'concentrate') {
              // –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç + —Ä–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ—Ü–µ–ø—Ç–æ–≤ —á–µ–º–ø–∏–æ–Ω–æ–≤)
              let coffeeWeight = 18;
              let brewWater = Math.round(coffeeWeight * 11); // ~1:11 –¥–ª—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç–∞
              let bloom = coffeeWeight * 2.8; // ~50–≥
              let secondPour = brewWater;
              let concentrate = Math.round(coffeeWeight * 4.2); // ~75–≥ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç–∞
              let dilution = volume - concentrate;

              return `
                  <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è Aeropress</h3>
                  <p><em>–°—Ç–∏–ª—å: –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç + —Ä–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ</em></p>
                  <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
                  <p>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã: <strong>${baseTemp.toFixed(1)}¬∞C</strong></p>
                  <p>‚öôÔ∏è –ü–æ–º–æ–ª (${grinderName}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
                  <p>üîÑ –ü–æ–∑–∏—Ü–∏—è: <strong>Inverted (–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞—è)</strong></p>
                  <br>
                  <h4>üíß –≠—Ç–∞–ø—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</h4>
                  <p>1Ô∏è‚É£ –ë–ª—é–º–∏–Ω–≥: <strong>${Math.round(bloom)} –º–ª</strong> –≤–æ–¥—ã (30 —Å–µ–∫)</p>
                  <p>2Ô∏è‚É£ –î–æ–ª–∏–≤ –¥–æ: <strong>${Math.round(secondPour)} –º–ª</strong></p>
                  <p>3Ô∏è‚É£ –í—Ä–µ–º—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏: <strong>1:30</strong> (–æ–±—â–µ–µ)</p>
                  <p>4Ô∏è‚É£ –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç –∏ –ø—Ä–µ—Å—Å–æ–≤–∞–Ω–∏–µ: <strong>30 —Å–µ–∫</strong></p>
                  <p>5Ô∏è‚É£ –ü–æ–ª—É—á–∏—Ç—Å—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç: <strong>~${concentrate} –º–ª</strong></p>
                  <p>6Ô∏è‚É£ –†–∞–∑–±–∞–≤–∏—Ç—å –≤–æ–¥–æ–π: <strong>+${Math.round(dilution)} –º–ª</strong> –¥–æ ${volume} –º–ª</p>
              `;
          } else {
              // –ü—Ä—è–º–æ–µ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ
              let ratio = 15; // –±–æ–ª–µ–µ –∫—Ä–µ–ø–∫–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –¥–ª—è –∞—ç—Ä–æ–ø—Ä–µ—Å—Å–∞
              let coffeeWeight = Math.round(volume / ratio * 10) / 10;
              let bloom = coffeeWeight * 2.8;
              let totalWater = volume;

              return `
                  <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è Aeropress</h3>
                  <p><em>–°—Ç–∏–ª—å: –ü—Ä—è–º–æ–µ –∑–∞–≤–∞—Ä–∏–≤–∞–Ω–∏–µ</em></p>
                  <p>‚òï –ö–æ—Ñ–µ: <strong>${coffeeWeight} –≥</strong></p>
                  <p>üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã: <strong>${baseTemp.toFixed(1)}¬∞C</strong></p>
                  <p>‚öôÔ∏è –ü–æ–º–æ–ª (${grinderName}): <strong>${Math.round(baseGrind)} –∫–ª–∏–∫–æ–≤</strong></p>
                  <p>üîÑ –ü–æ–∑–∏—Ü–∏—è: <strong>Inverted (–ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞—è)</strong></p>
                  <br>
                  <h4>üíß –≠—Ç–∞–ø—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</h4>
                  <p>1Ô∏è‚É£ –ë–ª—é–º–∏–Ω–≥: <strong>${Math.round(bloom)} –º–ª</strong> –≤–æ–¥—ã (30 —Å–µ–∫)</p>
                  <p>2Ô∏è‚É£ –î–æ–ª–∏–≤ –¥–æ: <strong>${Math.round(totalWater)} –º–ª</strong></p>
                  <p>3Ô∏è‚É£ –í—Ä–µ–º—è —ç–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏: <strong>1:30</strong> (–æ–±—â–µ–µ)</p>
                  <p>4Ô∏è‚É£ –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç –∏ –ø—Ä–µ—Å—Å–æ–≤–∞–Ω–∏–µ: <strong>30-40 —Å–µ–∫</strong></p>
                  <p>5Ô∏è‚É£ –ì–æ—Ç–æ–≤—ã–π –Ω–∞–ø–∏—Ç–æ–∫: <strong>${volume} –º–ª</strong></p>
              `;
          }
      }

      function getGrinderName(grinder) {
          const names = {
              'timemore_c3': 'Timemore C3',
              'comandante': 'Comandante',
              '1zpresso_jx': '1Zpresso JX',
              '1zpresso_je': '1Zpresso JE'
          };
          return names[grinder] || grinder;
      }

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
      window.onload = function() {
          calculate();
      };

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
      tg.onEvent('themeChanged', function() {
          if (tg.colorScheme === 'dark') {
              document.body.classList.add('dark-theme');
          } else {
              document.body.classList.remove('dark-theme');
          }
      });
    </script>
  </body>
</html>
